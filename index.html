<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>CPS Hauptprojekt – End-to-End Energie- und E-Mobilitäts-Simulation</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
  <header>
    <h1>CPS Hauptprojekt – End-to-End Energie- und E-Mobilitäts-Simulation</h1>
    <p>Visualisierung der Systemarchitektur nach PlantUML-Struktur (mit zeitlicher Ablaufanimation)</p>
  </header>

  <main>
    <svg id="diagram" viewBox="0 0 1400 900">

      <!-- Definitions -->
      <defs>
        <marker id="arrow" markerWidth="10" markerHeight="7" refX="8" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="black" />
        </marker>
      </defs>

      <!-- EBENE 1 -->
      <rect id="tick" class="node" x="600" y="60" width="200" height="60" />
      <text x="700" y="95" class="label">tick_gen</text>
      <text x="700" y="110" class="sublabel">Veröffentlicht: tickgen/tick</text>

      <!-- EBENE 2 -->
      <rect id="wt" class="node" x="250" y="220" width="220" height="80" />
      <text x="360" y="255" class="label">wind_turbine</text>
      <text x="360" y="275" class="sublabel">Liest DWD-Daten • Cp-Lookup</text>

      <rect id="gc" class="node" x="600" y="220" width="230" height="80" />
      <text x="715" y="255" class="label">grid_controller</text>
      <text x="715" y="275" class="sublabel">Balanciert Leistung & Nachfrage</text>

      <rect id="cons" class="node" x="980" y="220" width="200" height="80" />
      <text x="1080" y="255" class="label">consumers</text>
      <text x="1080" y="275" class="sublabel">BDEW-Lastprofile</text>

      <!-- EBENE 3 -->
      <rect id="cc" class="node" x="600" y="400" width="230" height="80" />
      <text x="715" y="435" class="label">central_controller</text>
      <text x="715" y="455" class="sublabel">Zentrale Zuweisungslogik</text>

      <rect id="ev" class="node" x="250" y="400" width="230" height="80" />
      <text x="365" y="435" class="label">n × ev_sim</text>
      <text x="365" y="455" class="sublabel">Fährt, lädt, nutzt OPC UA</text>

      <rect id="cl" class="node" x="980" y="400" width="220" height="80" />
      <text x="1090" y="435" class="label">m × charging_cluster</text>
      <text x="1090" y="455" class="sublabel">OPC UA-Server mit Ladeplätzen</text>

      <!-- EBENE 4 -->
      <rect id="mqtt" class="node" x="600" y="580" width="230" height="70" />
      <text x="715" y="610" class="label">MQTT-Broker</text>
      <text x="715" y="625" class="sublabel">Zentrale Kommunikations-Backbone</text>

      <rect id="opc" class="node" x="980" y="580" width="220" height="70" />
      <text x="1090" y="610" class="label">OPC UA-Netzwerk</text>
      <text x="1090" y="625" class="sublabel">Physikalische Lade-Schnittstelle</text>

      <!-- Sensor Layer -->
      <rect id="chaos" class="node" x="250" y="580" width="180" height="70" />
      <text x="340" y="610" class="label">chaos_sensor</text>

      <rect id="mean" class="node" x="250" y="680" width="180" height="70" />
      <text x="340" y="710" class="label">mean_processor</text>

      <!-- LINES (DATA FLOW) -->
      <!-- Tick -->
      <path id="tick_wt" class="arrow" d="M700,120 L360,220" marker-end="url(#arrow)" />
      <path id="tick_gc" class="arrow" d="M700,120 L715,220" marker-end="url(#arrow)" />
      <path id="tick_ev" class="arrow" d="M700,120 L365,400" marker-end="url(#arrow)" />
      <text x="500" y="160" class="arrowlabel">tickgen/tick</text>

      <!-- Energiefluss -->
      <path id="wt_mqtt" class="arrow" d="M470,260 L600,580" marker-end="url(#arrow)" />
      <text x="520" y="440" class="arrowlabel">windturbine/power</text>

      <path id="cons_mqtt" class="arrow" d="M1080,300 L715,580" marker-end="url(#arrow)" />
      <text x="900" y="440" class="arrowlabel">consumer/.../demand</text>

      <path id="gc_mqtt" class="arrow" d="M715,300 L715,580" marker-end="url(#arrow)" />
      <text x="720" y="500" class="arrowlabel">consumer/.../power_share</text>

      <!-- EV-Verhandlung -->
      <path id="ev_mqtt" class="arrow" d="M365,480 L715,580" marker-end="url(#arrow)" />
      <text x="500" y="520" class="arrowlabel">ev_sim/request</text>

      <path id="cc_mqtt" class="arrow" d="M715,480 L715,580" marker-end="url(#arrow)" />
      <text x="740" y="520" class="arrowlabel">ev_sim/assignment</text>

      <path id="cl_mqtt" class="arrow" d="M1090,480 L715,580" marker-end="url(#arrow)" />
      <text x="920" y="520" class="arrowlabel">cluster/x/y/price</text>

      <!-- OPC UA -->
      <path id="ev_opc" class="arrow" d="M365,480 L1090,580" marker-end="url(#arrow)" />
      <text x="720" y="560" class="arrowlabel">ConnectEV(), RequestCharge(), DisconnectEV()</text>

      <!-- Sensor -->
      <path id="chaos_mqtt" class="arrow" d="M340,650 L715,580" marker-end="url(#arrow)" />
      <text x="500" y="630" class="arrowlabel">chaossensor/.../data</text>

      <path id="mean_mqtt" class="arrow" d="M340,750 L715,580" marker-end="url(#arrow)" />
      <text x="500" y="720" class="arrowlabel">chaossensor/mean</text>

    </svg>
  </main>

  <footer>
    <p>© 2026 CPS Simulation – Generische Visualisierung</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
